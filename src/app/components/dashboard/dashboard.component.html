<div class="dashboard-container">
  <!-- Smart Header with Quick Actions -->
  <div class="smart-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="dashboard-title">📊 Smart Dashboard</h1>
        <p class="dashboard-subtitle">Complete financial overview at a glance</p>
      </div>
      <div class="quick-actions">
        <div class="action-buttons">
          <button class="action-btn primary" routerLink="/expenses">
            <span class="action-icon">➕</span>
            <span class="action-text">Add Expense</span>
          </button>
          <button class="action-btn secondary" (click)="exportData()">
            <span class="action-icon">📥</span>
            <span class="action-text">Export Data</span>
          </button>
          <button class="action-btn secondary" (click)="toggleInsights()">
            <span class="action-icon">{{ showInsights ? '📊' : '🔍' }}</span>
            <span class="action-text">{{ showInsights ? 'Hide Insights' : 'Show Insights' }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p class="loading-text">Loading dashboard...</p>
    </div>
  </div>

  <!-- Smart Filters Bar -->
  <div class="smart-filters">
    <div class="filter-tabs">
      <button 
        *ngFor="let filter of getSmartFilters()" 
        class="filter-tab" 
        [class.active]="selectedPeriod === filter.value"
        (click)="selectedPeriod = filter.value; onFilterChange()">
        <span class="filter-label">{{ filter.label }}</span>
        <span class="filter-description">{{ filter.description }}</span>
      </button>
    </div>
    
    <!-- Custom Date Range with Start and End Date Inputs -->
    <div class="custom-date-range" *ngIf="selectedPeriod === 'custom'">
      <div class="date-range-container">
        <div class="date-input-group">
          <label class="date-label">Start Date</label>
          <input 
            type="date" 
            class="date-input" 
            [(ngModel)]="customStartDate"
            (change)="onCustomDateChange()"
            placeholder="Start date">
        </div>
        <div class="date-separator">
          <span class="separator-text">to</span>
        </div>
        <div class="date-input-group">
          <label class="date-label">End Date</label>
          <div class="end-date-container">
            <input 
              type="date" 
              class="date-input" 
              [(ngModel)]="customEndDate"
              (change)="onCustomDateChange()"
              placeholder="End date">
            <button 
              *ngIf="customStartDate || customEndDate"
              class="clear-date-btn" 
              (click)="clearCustomDateRange()"
              title="Clear date range">
              <span class="clear-icon">✕</span>
            </button>
          </div>
        </div>
      </div>
      <!-- Date Range Validation Message -->
      <div class="date-validation" *ngIf="customStartDate && customEndDate">
        <div class="validation-message" [class]="isCustomDateRangeValid() ? 'valid' : 'invalid'">
          <span class="validation-icon">{{ isCustomDateRangeValid() ? '✅' : '⚠️' }}</span>
          <span class="validation-text">
            {{ isCustomDateRangeValid() ? 
              'Date range is valid' : 
              'End date must be after start date' }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Month Only Filter -->
  <div class="month-only-filter" *ngIf="selectedPeriod === 'monthOnly'">
    <div class="month-only-container">
      <div class="month-input-group">
        <label class="month-label">Select Month</label>
        <select class="month-select" [(ngModel)]="selectedMonthOnly" (change)="onMonthOnlyChange()">
          <option value="">Select Month</option>
          <option *ngFor="let month of availableMonths" [value]="month.value">
            {{ month.label }}
          </option>
        </select>
      </div>
      <div class="year-input-group">
        <label class="year-label">Select Year</label>
        <select class="year-select" [(ngModel)]="selectedYearOnly" (change)="onMonthOnlyChange()">
          <option value="">Select Year</option>
          <option *ngFor="let year of availableYears" [value]="year">
            {{ year }}
          </option>
        </select>
      </div>
    </div>
    <!-- Month Range Display -->
    <div class="month-range-display" *ngIf="customStartDate && customEndDate">
      <div class="range-info">
        <span class="range-label">Selected Range:</span>
        <span class="range-dates">{{ customStartDate }} to {{ customEndDate }}</span>
      </div>
    </div>
  </div>

  <!-- Quick Summary Cards -->
  <div class="summary-grid" *ngIf="!isLoading">
    <div class="summary-card" *ngFor="let card of getQuickSummaryCards()">
      <div class="card-header">
        <span class="card-icon">{{ card.icon }}</span>
        <span class="card-title">{{ card.title }}</span>
      </div>
      <div class="card-content">
        <div class="card-value">{{ card.value }}</div>
        <div class="card-change" [class]="'trend-' + card.trend">
          <span class="change-icon">
            {{ card.trend === 'up' ? '📈' : card.trend === 'down' ? '📉' : '➡️' }}
          </span>
          <span class="change-text">{{ card.change }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Smart Insights Section -->
  <div id="insights-section" class="insights-section" *ngIf="showInsights">
    <div class="section-header">
      <h2>🧠 Smart Insights</h2>
      <p>AI-powered recommendations based on your spending patterns</p>
    </div>
    
    <div class="insights-grid">
      <!-- Smart Recommendations -->
      <div class="insight-card recommendations">
        <div class="card-header">
          <span class="card-icon">💡</span>
          <h3>Smart Recommendations</h3>
        </div>
        <div class="card-content">
          <div class="recommendation-item" *ngFor="let rec of getSmartRecommendations()">
            <div class="rec-priority" [class]="'priority-' + rec.priority"></div>
            <div class="rec-content">
              <h4>{{ rec.title }}</h4>
              <p>{{ rec.description }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Spending Analytics -->
      <div class="insight-card analytics">
        <div class="card-header">
          <span class="card-icon">📊</span>
          <h3>Spending Analytics</h3>
        </div>
        <div class="card-content">
          <div class="analytics-grid">
            <div class="analytics-item">
              <span class="analytics-label">Total Expenses</span>
              <span class="analytics-value">{{ getSpendingAnalytics().totalExpenses }}</span>
            </div>
            <div class="analytics-item">
              <span class="analytics-label">Average Per Expense</span>
              <span class="analytics-value">₹{{ getSpendingAnalytics().averagePerExpense.toFixed(0) }}</span>
            </div>
            <div class="analytics-item">
              <span class="analytics-label">Highest Expense</span>
              <span class="analytics-value">₹{{ getSpendingAnalytics().highestExpense.toFixed(0) }}</span>
            </div>
            <div class="analytics-item">
              <span class="analytics-label">Recent Trend</span>
              <span class="analytics-value" [class]="'trend-' + getSpendingAnalytics().recentTrend.trend">
                {{ getSpendingAnalytics().recentTrend.trend }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Category Insights -->
      <div class="insight-card categories">
        <div class="card-header">
          <span class="card-icon">🏷️</span>
          <h3>Category Insights</h3>
        </div>
        <div class="card-content">
          <div class="category-insight" *ngIf="getSpendingAnalytics().mostExpensiveCategory">
            <h4>Most Expensive Category</h4>
            <p>{{ getSpendingAnalytics().mostExpensiveCategory.name }} - {{ getSpendingAnalytics().mostExpensiveCategory.percentage.toFixed(1) }}%</p>
          </div>
          <div class="category-insight" *ngIf="getSpendingAnalytics().leastExpensiveCategory">
            <h4>Least Expensive Category</h4>
            <p>{{ getSpendingAnalytics().leastExpensiveCategory.name }} - {{ getSpendingAnalytics().leastExpensiveCategory.percentage.toFixed(1) }}%</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="content-grid" *ngIf="!isLoading">
    <!-- Enhanced Category Breakdown with Visual Analytics -->
    <div class="content-card category-section">
      <div class="card-header">
        <div class="header-left">
          <span class="header-icon">🏷️</span>
          <h5 class="header-title">Category-wise Spending</h5>
        </div>
        <div class="header-right">
          <div class="summary-stats">
            <div class="stat-item">
              <span class="stat-label">Total</span>
              <span class="stat-value">₹{{ getFilteredTotal() | number }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Period</span>
              <span class="stat-value">{{ getFilterLabel() }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card-body">
        <!-- Category Summary Chart -->
        <div class="category-summary" *ngIf="getCategoriesSortedByExpense().length > 0">
          <div class="summary-chart">
            <div class="chart-bar" 
                 *ngFor="let category of getCategoriesSortedByExpense(); let i = index"
                 [style.width.%]="getCategoryPercentage(category?.id || '')"
                 [style.background-color]="category?.color || '#999'"
                 [title]="category?.name + ': ' + getCategoryPercentage(category?.id || '') + '%'">
              <div class="bar-tooltip">
                <div class="tooltip-category">{{ category?.name }}</div>
                <div class="tooltip-percentage">{{ getCategoryPercentage(category?.id || '') }}%</div>
                <div class="tooltip-amount">₹{{ categoryTotals[category?.id || ''] || 0 | number }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Detailed Category List -->
        <div class="category-list" *ngIf="getCategoriesSortedByExpense().length > 0">
          <div class="category-item" 
               *ngFor="let category of getCategoriesSortedByExpense(); let i = index"
               [class.empty-category]="categoryTotals[category?.id || ''] === 0">
            
            <!-- Category Visual Indicator -->
            <div class="category-visual">
              <div class="category-icon" [style.background-color]="category?.color || '#999'">
                {{ category?.icon || '📌' }}
              </div>
              <div class="category-progress">
                <div class="progress-bar">
                  <div class="progress-fill" 
                       [style.width.%]="getCategoryPercentage(category?.id || '')"
                       [style.background-color]="category?.color || '#999'">
                  </div>
                </div>
                <div class="progress-label">{{ getCategoryPercentage(category?.id || '') }}%</div>
              </div>
            </div>

            <!-- Category Information -->
            <div class="category-info">
              <div class="category-header">
                <div class="category-name">{{ category?.name || 'Unknown' }}</div>
                <div class="category-rank">#{{ i + 1 }}</div>
              </div>
              
              <div class="category-stats">
                <div class="stat-row">
                  <div class="stat-item">
                    <span class="stat-icon">📊</span>
                    <span class="stat-label">Expenses</span>
                    <span class="stat-value">{{ getExpensesByCategory(category?.id || '').length }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-icon">💰</span>
                    <span class="stat-label">Average</span>
                    <span class="stat-value">₹{{ (categoryTotals[category?.id || ''] / getExpensesByCategory(category?.id || '').length).toFixed(0) }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-icon">📈</span>
                    <span class="stat-label">Highest</span>
                    <span class="stat-value">₹{{ getMaxExpenseForCategory(category?.id || '') }}</span>
                  </div>
                </div>
              </div>

              <!-- Category Insights -->
              <div class="category-insights" *ngIf="getCategoryInsights(category?.id || '').length > 0">
                <div class="insight-badge" 
                     *ngFor="let insight of getCategoryInsights(category?.id || '')"
                     [class]="'insight-' + insight.type">
                  <span class="insight-icon">{{ insight.icon }}</span>
                  <span class="insight-text">{{ insight.text }}</span>
                </div>
              </div>
            </div>

            <!-- Category Amount and Actions -->
            <div class="category-amount">
              <div class="amount-display">
                <div class="amount-value">₹{{ categoryTotals[category?.id || ''] || 0 | number }}</div>
                <div class="amount-trend" *ngIf="getCategoryTrend(category?.id || '')">
                  <span class="trend-icon">{{ getCategoryTrend(category?.id || '').icon }}</span>
                  <span class="trend-text">{{ getCategoryTrend(category?.id || '').text }}</span>
                </div>
              </div>
              
              <div class="category-actions">
                <button class="action-btn primary" (click)="viewCategoryDetails(category?.id || '')" title="View Category Expenses">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" fill="currentColor"/>
                  </svg>
                  <span>View Expenses</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="empty-state" *ngIf="getCategoriesSortedByExpense().length === 0">
          <div class="empty-icon">🏷️</div>
          <h6>No Categories Found</h6>
          <p>Add some categories to start tracking your expenses!</p>
          <div class="empty-action">
            <a class="btn" routerLink="/categories">Add Categories</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Recent Expenses with Smart Insights -->
    <div class="content-card recent-section">
      <div class="card-header">
        <div class="header-left">
          <span class="header-icon">📝</span>
          <h5 class="header-title">Recent Expenses</h5>
        </div>
        <div class="header-right">
          <div class="expense-summary">
            <div class="summary-item">
              <span class="summary-label">{{ getFilterLabel() }}</span>
              <span class="summary-value">₹{{ getFilteredTotal() | number }}</span>
            </div>
          </div>
          <button class="btn btn-sm btn-outline-primary" (click)="viewAllExpenses()">
            View All
          </button>
        </div>
      </div>
      
      <div class="card-body">
        <!-- Expense Timeline -->
        <div class="expense-timeline" *ngIf="getRecentExpensesSorted().length > 0">
          <div class="timeline-item" *ngFor="let expense of getRecentExpensesSorted(); let i = index">
            
            <!-- Expense Card -->
            <div class="expense-card">
              <div class="expense-header">
                <div class="expense-icon" [style.background-color]="getCategoryColor(expense.categoryId)">
                  {{ getCategoryIcon(expense.categoryId) }}
                </div>
                <div class="expense-meta">
                  <div class="expense-date">{{ expense.date | date:'MMM dd, yyyy' }}</div>
                </div>
                <div class="expense-amount">
                  <div class="amount-value">₹{{ expense.amount | number }}</div>
                  <div class="amount-indicator" [class]="getAmountIndicator(expense.amount)">
                    {{ getAmountIndicator(expense.amount) }}
                  </div>
                </div>
              </div>
              
              <div class="expense-content">
                <div class="expense-description">{{ expense.description || 'No description' }}</div>
                
                <div class="expense-details">
                  <div class="detail-row">
                    <div class="detail-item">
                      <span class="detail-icon">🏷️</span>
                      <span class="detail-label">Category</span>
                      <span class="detail-value">{{ getCategoryName(expense.categoryId) }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-icon">📅</span>
                      <span class="detail-label">Day</span>
                      <span class="detail-value">{{ getDayOfWeek(expense.date) }}</span>
                    </div>
                  </div>
                  
                  <div class="detail-row" *ngIf="expense.priority || expense.amount > 1000">
                    <div class="detail-item" *ngIf="expense.priority">
                      <span class="detail-icon">⚡</span>
                      <span class="detail-label">Priority</span>
                      <span class="detail-value priority-badge" [class]="'priority-' + expense.priority">
                        {{ expense.priority }}
                      </span>
                    </div>
                    <div class="detail-item" *ngIf="expense.amount > 1000">
                      <span class="detail-icon">💰</span>
                      <span class="detail-label">Type</span>
                      <span class="detail-value type-badge large-expense">Large Expense</span>
                    </div>
                  </div>
                </div>

                <!-- Smart Insights -->
                <div class="expense-insights" *ngIf="getExpenseInsights(expense).length > 0">
                  <div class="insight-badge" 
                       *ngFor="let insight of getExpenseInsights(expense)"
                       [class]="'insight-' + insight.type">
                    <span class="insight-icon">{{ insight.icon }}</span>
                    <span class="insight-text">{{ insight.text }}</span>
                  </div>
                </div>
              </div>
              
              <div class="expense-actions">
                <button class="action-btn primary" (click)="editExpense(expense)" title="Edit Expense">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>Edit</span>
                </button>

                <button class="action-btn danger" (click)="deleteExpense(expense)" title="Delete">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>Delete</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="empty-state" *ngIf="getRecentExpensesSorted().length === 0">
          <div class="empty-icon">📝</div>
          <h6>No Expenses Found</h6>
          <p>Add some expenses to see them here!</p>
          <div class="empty-action">
            <a class="btn" routerLink="/expenses">Add Expenses</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Spending Patterns -->
    <div class="content-card patterns-section">
      <div class="card-header">
        <span class="header-icon">📈</span>
        <h5 class="header-title">Spending Patterns</h5>
      </div>
      
      <div class="card-body">
        <!-- Day of Week Pattern -->
        <div class="pattern-section">
          <h6>Spending by Day of Week</h6>
          <div class="pattern-chart" *ngIf="getSpendingByDay().length > 0 && getMaxSpendingAmount() > 0">
            <div class="chart-bar" *ngFor="let day of getSpendingByDay()" 
                 [style.height.%]="(day.amount / getMaxSpendingAmount()) * 100">
              <div class="bar-tooltip">
                <div class="tooltip-day">{{ day.day }}</div>
                <div class="tooltip-amount">₹{{ day.amount | number }}</div>
                <div class="tooltip-count">{{ day.count }} expenses</div>
              </div>
            </div>
          </div>
          <div class="empty-state compact" *ngIf="getSpendingByDay().length === 0 || getMaxSpendingAmount() === 0">
            <div class="empty-icon">📊</div>
            <h6>No Spending Data</h6>
            <p>No expenses found for the selected period</p>
          </div>
        </div>

        <!-- Top Expenses -->
        <div class="pattern-section">
          <h6>Top 5 Expenses</h6>
          <div class="top-expenses" *ngIf="getTopExpenses(5).length > 0">
            <div class="top-expense" *ngFor="let expense of getTopExpenses(5); let i = index">
              <div class="rank">{{ i + 1 }}</div>
              <div class="expense-info">
                <div class="expense-name">{{ expense.description || 'No description' }}</div>
                <div class="expense-category">{{ getCategoryName(expense.categoryId) }}</div>
              </div>
              <div class="expense-amount">₹{{ expense.amount | number }}</div>
            </div>
          </div>
          <div class="empty-state compact" *ngIf="getTopExpenses(5).length === 0">
            <div class="empty-icon">🏆</div>
            <h6>No Top Expenses</h6>
            <p>Add some expenses to see your top spending patterns</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions-panel">
    <div class="panel-header">
      <h3>⚡ Quick Actions</h3>
    </div>
    <div class="actions-grid">
      <div class="action-item" *ngFor="let action of getQuickActions()">
        <a class="action-card" 
           *ngIf="action.route"
           [routerLink]="action.route">
          <span class="action-icon">{{ action.icon }}</span>
          <div class="action-content">
            <h4>{{ action.title }}</h4>
            <p>{{ action.action }}</p>
          </div>
        </a>
        <button class="action-card" 
                *ngIf="action.method"
                (click)="action.method()">
          <span class="action-icon">{{ action.icon }}</span>
          <div class="action-content">
            <h4>{{ action.title }}</h4>
            <p>{{ action.action }}</p>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>

 