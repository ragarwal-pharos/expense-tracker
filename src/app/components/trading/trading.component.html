<div class="container-fluid px-4 py-3">
  <!-- Page Header -->
  <div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <div class="header-icon me-3">
          <span class="fs-1">üìà</span>
        </div>
        <div>
          <h1 class="page-title mb-1">Trading</h1>
          <p class="mb-0">Track your share market trades, profits, and losses</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <app-loading 
    *ngIf="isLoading" 
    message="Loading trades..." 
    type="card">
  </app-loading>

  <!-- Statistics Cards -->
  <div class="row mb-4" *ngIf="!isLoading">
    <div class="col-md-3 mb-3">
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-content">
          <div class="stat-label">Total Trades</div>
          <div class="stat-value">{{ trades.length }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="stat-card">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-content">
          <div class="stat-label">Total Profit</div>
          <div class="stat-value profit">{{ formatCurrency(getTotalProfitAmount()) }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="stat-card">
        <div class="stat-icon">‚ùå</div>
        <div class="stat-content">
          <div class="stat-label">Total Loss</div>
          <div class="stat-value loss">{{ formatCurrency(getTotalLossAmount()) }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-content">
          <div class="stat-label">Net P&L</div>
          <div class="stat-value" [class]="getProfitLossClass(getNetProfitLoss())">
            {{ formatCurrency(getNetProfitLoss()) }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Global Search Bar -->
  <div class="search-card mb-4" *ngIf="!isLoading">
    <div class="card-body-modern">
      <div class="search-container">
        <div class="search-input-group">
          <span class="search-icon">üîç</span>
          <input 
            type="text" 
            class="search-input" 
            placeholder="Search trades by any property (index, amount, date, type, notes...)"
            [(ngModel)]="globalSearch"
            name="globalSearch">
          <button 
            *ngIf="globalSearch" 
            class="clear-search-btn" 
            (click)="globalSearch = ''" 
            title="Clear search">
            ‚úï
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Trade Form -->
  <div class="add-trade-card mb-4" *ngIf="!isLoading">
    <div class="card-header-modern">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <span class="header-icon-small me-2">‚ûï</span>
          <h5 class="mb-0">Add New Trade</h5>
        </div>
        <button class="collapse-toggle-btn" type="button" (click)="toggleAddTradeSection()">
          <span class="collapse-icon" [class.rotated]="!isAddTradeExpanded">‚ñº</span>
        </button>
      </div>
    </div>
    <div class="card-body-modern collapsible-content" [class.collapsed]="!isAddTradeExpanded">
      <form (ngSubmit)="addTrade()">
        <div class="form-row">
          <div class="form-group">
            <label for="tradeIndex" class="form-label-modern">Index</label>
            <select 
              class="form-control-modern" 
              id="tradeIndex"
              [(ngModel)]="newTrade.symbol"
              name="symbol"
              required>
              <option value="" disabled selected>Select Index</option>
              <option *ngFor="let index of availableIndices" [value]="index">
                {{ index.toUpperCase() }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="tradeIndexValue" class="form-label-modern">Index Value</label>
            <input 
              type="number" 
              class="form-control-modern" 
              id="tradeIndexValue"
              [(ngModel)]="indexValueInput"
              placeholder="Enter index value"
              step="1"
              min="1"
              inputmode="numeric"
              pattern="[0-9]*"
              (keydown)="preventNonInteger($event)"
              (input)="sanitizeIntegerInput('indexValueInput')"
              name="indexValue"
              required>
          </div>
          <div class="form-group">
            <label for="tradeType" class="form-label-modern">Trade Type</label>
            <select 
              class="form-control-modern" 
              id="tradeType"
              [(ngModel)]="newTrade.tradeType"
              name="tradeType"
              required>
              <option value="" disabled selected>Select Trade Type</option>
              <option *ngFor="let type of availableTradeTypes" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="tradeProfitLoss" class="form-label-modern">Profit/Loss</label>
            <select 
              class="form-control-modern" 
              id="tradeProfitLoss"
              [(ngModel)]="newTrade.isProfit"
              name="isProfit"
              required>
              <option [ngValue]="undefined" disabled selected>Select Profit/Loss</option>
              <option [ngValue]="true">Profit</option>
              <option [ngValue]="false">Loss</option>
            </select>
          </div>
          <div class="form-group">
            <label for="tradeAmount" class="form-label-modern">Amount</label>
            <div class="input-group-modern">
              <span class="input-group-text-modern">‚Çπ</span>
              <input 
                type="number" 
                class="form-control-modern" 
                id="tradeAmount"
                [(ngModel)]="amountInput"
                placeholder="0"
                step="1"
                min="1"
                inputmode="numeric"
                pattern="[0-9]*"
                (keydown)="preventNonInteger($event)"
                (input)="sanitizeIntegerInput('amountInput')"
                name="amount"
                required>
            </div>
          </div>
          <div class="form-group">
            <label for="tradeDate" class="form-label-modern">Trade Date</label>
            <input 
              type="date" 
              class="form-control-modern" 
              id="tradeDate"
              [(ngModel)]="newTrade.date"
              name="date"
              required>
          </div>
          <div class="form-group">
            <label for="tradeNotes" class="form-label-modern">Notes</label>
            <input 
              type="text" 
              class="form-control-modern" 
              id="tradeNotes"
              [(ngModel)]="newTrade.notes"
              placeholder="Additional notes about this trade..."
              name="notes">
          </div>
          <div class="form-group button-group">
            <label class="form-label-modern">&nbsp;</label>
            <button
              type="submit"
              class="btn-add-trade"
              [disabled]="isSaving || !isAddTradeFormValid()">
              <span class="btn-icon-wrapper" *ngIf="!isSaving">
                <span class="btn-icon">‚ûï</span>
              </span>
              <span class="btn-text" *ngIf="!isSaving">Add Trade</span>
              <span class="btn-text" *ngIf="isSaving">Saving...</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-card mb-4" *ngIf="!isLoading">
    <div class="card-header-modern">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="d-flex align-items-center">
          <span class="header-icon-small me-2">üîç</span>
          <h5 class="mb-0">Filters</h5>
        </div>
        <div class="d-flex align-items-center gap-2">
          <button 
            class="btn btn-sm btn-outline-secondary clear-filters-btn"
            (click)="clearFilters()"
            [disabled]="!hasActiveFilters()"
            title="Clear all filters">
            <span class="clear-icon">üóëÔ∏è</span>
            <span class="clear-text">Clear Filters</span>
          </button>
          <button class="collapse-toggle-btn" type="button" (click)="toggleFiltersSection()">
            <span class="collapse-icon" [class.rotated]="!isFiltersExpanded">‚ñº</span>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body-modern" *ngIf="isFiltersExpanded">
      <!-- Preset Date Range Quick Filters -->
      <div class="mb-4 quick-date-filters">
        <label class="form-label mb-2">Quick Date Filters</label>
        <div class="quick-filters-container">
          <button 
            type="button"
            class="btn quick-filter-btn"
            [class.active]="isPresetActive('today')"
            (click)="setPresetDateRange('today')">
            Today
          </button>
          <button 
            type="button"
            class="btn quick-filter-btn"
            [class.active]="isPresetActive('yesterday')"
            (click)="setPresetDateRange('yesterday')">
            Yesterday
          </button>
          <button 
            type="button"
            class="btn quick-filter-btn"
            [class.active]="isPresetActive('thisWeek')"
            (click)="setPresetDateRange('thisWeek')">
            This Week
          </button>
          <button 
            type="button"
            class="btn quick-filter-btn"
            [class.active]="isPresetActive('lastWeek')"
            (click)="setPresetDateRange('lastWeek')">
            Last Week
          </button>
          <button 
            type="button"
            class="btn quick-filter-btn"
            [class.active]="isPresetActive('thisMonth')"
            (click)="setPresetDateRange('thisMonth')">
            This Month
          </button>
          <button 
            type="button"
            class="btn quick-filter-btn"
            [class.active]="isPresetActive('lastMonth')"
            (click)="setPresetDateRange('lastMonth')">
            Last Month
          </button>
          <button 
            type="button"
            class="btn quick-filter-btn"
            [class.active]="isPresetActive('custom')"
            (click)="setPresetDateRange('custom')">
            Custom
          </button>
          <button 
            type="button"
            class="btn quick-filter-btn clear-dates-btn"
            *ngIf="filterDateFrom || filterDateTo"
            (click)="clearPresetDateRange()">
            Clear Dates
          </button>
        </div>
        
        <!-- Custom Date Range Picker -->
        <div *ngIf="showCustomDatePicker" class="custom-date-range-picker mt-3 p-3" style="background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
          <div class="row">
            <div class="col-md-6 mb-3 mb-md-0">
              <label class="form-label">Start Date</label>
              <input 
                type="date" 
                class="form-control" 
                [(ngModel)]="filterDateFrom"
                (change)="onCustomDateRangeChange()">
            </div>
            <div class="col-md-6">
              <label class="form-label">End Date</label>
              <input 
                type="date" 
                class="form-control" 
                [(ngModel)]="filterDateTo"
                (change)="onCustomDateRangeChange()">
            </div>
          </div>
          <div class="mt-2">
            <button 
              type="button"
              class="btn btn-sm btn-outline-secondary"
              (click)="showCustomDatePicker = false">
              Close
            </button>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label">Index</label>
          <select 
            class="form-select" 
            [(ngModel)]="filterSymbol">
            <option value="">All Indices</option>
            <option *ngFor="let index of availableIndices" [value]="index">
              {{ index.toUpperCase() }}
            </option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Profit/Loss</label>
          <select 
            class="form-select" 
            [(ngModel)]="filterProfitLoss">
            <option value="">All</option>
            <option value="profit">Profit Only</option>
            <option value="loss">Loss Only</option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Trade Type</label>
          <select 
            class="form-select" 
            [(ngModel)]="filterTradeType">
            <option value="">All Types</option>
            <option value="call">Call</option>
            <option value="put">Put</option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Date From</label>
          <input 
            type="date" 
            class="form-control" 
            [(ngModel)]="filterDateFrom">
        </div>
      </div>
      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label">Date To</label>
          <input 
            type="date" 
            class="form-control" 
            [(ngModel)]="filterDateTo">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Sort By</label>
          <select class="form-select" [(ngModel)]="sortBy">
            <option value="date">Date</option>
            <option value="symbol">Index</option>
            <option value="tradeType">Trade Type</option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Sort Order</label>
          <select class="form-select" [(ngModel)]="sortOrder">
            <option value="desc">Descending</option>
            <option value="asc">Ascending</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 mb-3">
          <div class="form-check">
            <input 
              class="form-check-input" 
              type="checkbox" 
              id="filterByMonthYear"
              [(ngModel)]="filterByMonthYear"
              (change)="onMonthYearFilterChange()">
            <label class="form-check-label" for="filterByMonthYear">
              Filter by Month & Year
            </label>
          </div>
        </div>
        <div class="col-md-3 mb-3" *ngIf="filterByMonthYear">
          <label class="form-label">Month</label>
          <select 
            class="form-select" 
            [(ngModel)]="selectedMonth"
            (change)="onMonthYearFilterChange()">
            <option value="">Select Month</option>
            <option *ngFor="let month of availableMonths" [value]="month.value">
              {{ month.label }}
            </option>
          </select>
        </div>
        <div class="col-md-3 mb-3" *ngIf="filterByMonthYear">
          <label class="form-label">Year</label>
          <select 
            class="form-select" 
            [(ngModel)]="selectedYear"
            (change)="onMonthYearFilterChange()">
            <option value="">Select Year</option>
            <option *ngFor="let year of availableYears" [value]="year">
              {{ year }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Trading Charts Section -->
  <div class="trading-charts-section mb-4" *ngIf="!isLoading && trades.length > 0">
    <div class="charts-header">
      <div class="charts-title">
        <h3>üìä Trading Analytics</h3>
        <p>Visual insights into your trading performance and patterns</p>
      </div>
      <div class="charts-controls">
        <button class="btn-charts" (click)="toggleCharts()" [class.active]="showCharts">
          <span class="chart-icon">{{ showCharts ? 'üìä' : 'üìà' }}</span>
          {{ showCharts ? 'Hide Charts' : 'Show Charts' }}
        </button>
      </div>
    </div>

    <div class="charts-grid" *ngIf="showCharts">
      <!-- Monthly P&L Trend Chart -->
      <div class="chart-card" *ngIf="monthlyPnlChartData">
        <div class="chart-header">
          <h4>üìà Monthly P&L Trend</h4>
          <p>Net profit/loss by month</p>
        </div>
        <div class="chart-container">
          <canvas baseChart
                  [data]="monthlyPnlChartData"
                  [options]="getMonthlyPnlChartOptions()"
                  type="line">
          </canvas>
        </div>
      </div>

      <!-- Profit vs Loss Pie Chart -->
      <div class="chart-card" *ngIf="profitLossPieChartData">
        <div class="chart-header">
          <h4>ü•ß Profit vs Loss</h4>
          <p>Total profit and loss comparison</p>
        </div>
        <div class="chart-container">
          <canvas baseChart
                  [data]="profitLossPieChartData"
                  [options]="getPieChartOptions()"
                  type="pie">
          </canvas>
        </div>
      </div>

      <!-- Cumulative P&L Chart -->
      <div class="chart-card" *ngIf="cumulativePnlChartData">
        <div class="chart-header">
          <h4>üìä Cumulative P&L</h4>
          <p>Running total of profit/loss over time</p>
        </div>
        <div class="chart-container">
          <canvas baseChart
                  [data]="cumulativePnlChartData"
                  [options]="getCumulativePnlChartOptions()"
                  type="line">
          </canvas>
        </div>
      </div>

      <!-- Trade Type Distribution -->
      <div class="chart-card" *ngIf="tradeTypeChartData">
        <div class="chart-header">
          <h4>üîÑ Trade Type Distribution</h4>
          <p>Call vs Put trades breakdown</p>
        </div>
        <div class="chart-container">
          <canvas baseChart
                  [data]="tradeTypeChartData"
                  [options]="getDoughnutChartOptions()"
                  type="doughnut">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Monthly Summary -->
  <div class="monthly-summary-card mb-4" *ngIf="!isLoading && getMonthlySummary().length > 0">
    <div class="card-header-modern">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <span class="header-icon-small me-2">üìÜ</span>
          <h5 class="mb-0">Monthly Summary</h5>
        </div>
        <button class="collapse-toggle-btn" type="button" (click)="toggleMonthlySummarySection()">
          <span class="collapse-icon" [class.rotated]="!isMonthlySummaryExpanded">‚ñº</span>
        </button>
      </div>
    </div>
    <div class="card-body-modern" *ngIf="isMonthlySummaryExpanded">
      <!-- Desktop Table View -->
      <div class="table-responsive d-none d-md-block">
        <table class="table table-hover monthly-summary-table">
          <thead>
            <tr>
              <th style="width: 30px;"></th>
              <th>Month & Year</th>
              <th>Total Trades</th>
              <th>Profit Trades</th>
              <th>Loss Trades</th>
              <th>Total Profit</th>
              <th>Total Loss</th>
              <th>Net P&L</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let month of getPaginatedMonthlySummary(); trackBy: trackByMonthYear"
              class="monthly-summary-row"
              (click)="showMonthlyTrades(month.month, month.year)"
              style="cursor: pointer;">
              <td>
                <span class="expand-icon">üëÅÔ∏è</span>
              </td>
              <td><strong>{{ month.monthYear }}</strong></td>
              <td>{{ month.totalTrades }}</td>
              <td>
                <span class="badge bg-success">{{ month.profitCount }}</span>
              </td>
              <td>
                <span class="badge bg-danger">{{ month.lossCount }}</span>
              </td>
              <td class="profit">{{ formatCurrency(month.totalProfit) }}</td>
              <td class="loss">{{ formatCurrency(month.totalLoss) }}</td>
              <td>
                <strong [class]="getProfitLossClass(month.netPnl)">{{ formatCurrency(month.netPnl) }}</strong>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="monthly-summary-cards-mobile d-md-none">
        <div
          *ngFor="let month of getPaginatedMonthlySummary(); trackBy: trackByMonthYear"
          class="monthly-summary-card-mobile"
          (click)="showMonthlyTrades(month.month, month.year)">
          <div class="monthly-summary-header">
            <div class="monthly-summary-left">
              <div class="monthly-summary-month">{{ month.monthYear }}</div>
              <div class="monthly-summary-count">{{ month.totalTrades }} trade{{ month.totalTrades !== 1 ? 's' : '' }}</div>
            </div>
            <div class="monthly-summary-right">
              <div class="monthly-summary-net">
                <div class="net-pnl">
                  <strong [class]="getProfitLossClass(month.netPnl)">{{ formatCurrency(month.netPnl) }}</strong>
                </div>
              </div>
              <span class="expand-icon">üëÅÔ∏è</span>
            </div>
          </div>
          <div class="monthly-summary-details">
            <div class="monthly-summary-badges">
              <span class="badge bg-success">{{ month.profitCount }} Profit</span>
              <span class="badge bg-danger">{{ month.lossCount }} Loss</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Monthly Summary Pagination -->
      <div *ngIf="getMonthlyTotalPages() > 1" class="pagination-container mt-3">
        <nav>
          <ul class="pagination justify-content-center mb-0">
            <li class="page-item" [class.disabled]="monthlyCurrentPage === 1">
              <a class="page-link" (click)="previousMonthlyPage()" href="javascript:void(0)">Previous</a>
            </li>
            <li 
              *ngFor="let page of getMonthlyPageNumbers()" 
              class="page-item" 
              [class.active]="page === monthlyCurrentPage">
              <a class="page-link" (click)="goToMonthlyPage(page)" href="javascript:void(0)">{{ page }}</a>
            </li>
            <li class="page-item" [class.disabled]="monthlyCurrentPage === getMonthlyTotalPages()">
              <a class="page-link" (click)="nextMonthlyPage()" href="javascript:void(0)">Next</a>
            </li>
          </ul>
        </nav>
        <div class="text-center mt-2 text-muted" style="font-size: 0.85rem;">
          Page {{ monthlyCurrentPage }} of {{ getMonthlyTotalPages() }} ({{ getFilteredMonthlySummary().length }} month{{ getFilteredMonthlySummary().length !== 1 ? 's' : '' }})
        </div>
      </div>
    </div>
  </div>

  <!-- Daily Summary -->
  <div class="daily-summary-card mb-4" *ngIf="!isLoading && getFilteredDailySummary().length > 0">
    <div class="card-header-modern">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <span class="header-icon-small me-2">üìÖ</span>
          <h5 class="mb-0">Daily Summary (Net P&L per Day)</h5>
        </div>
      </div>
    </div>
    <div class="card-body-modern">
      <!-- Desktop Table View -->
      <div class="table-responsive d-none d-md-block">
        <table class="table table-hover daily-summary-table">
          <thead>
            <tr>
              <th style="width: 30px;"></th>
              <th>Date</th>
              <th>Total Trades</th>
              <th>Profit Trades</th>
              <th>Loss Trades</th>
              <th>Total Profit</th>
              <th>Total Loss</th>
              <th>Net P&L</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let day of getPaginatedDailySummary(); trackBy: trackByDate"
              class="daily-summary-row"
              (click)="showDailyTrades(day.date)"
              style="cursor: pointer;">
              <td>
                <span class="expand-icon">üëÅÔ∏è</span>
              </td>
              <td><strong>{{ formatDate(day.date) }}</strong></td>
              <td>{{ day.totalTrades }}</td>
              <td>
                <span class="badge bg-success">{{ day.profitCount }}</span>
              </td>
              <td>
                <span class="badge bg-danger">{{ day.lossCount }}</span>
              </td>
              <td class="profit">{{ formatCurrency(day.totalProfit) }}</td>
              <td class="loss">{{ formatCurrency(day.totalLoss) }}</td>
              <td>
                <strong [class]="getProfitLossClass(day.netPnl)">{{ formatCurrency(day.netPnl) }}</strong>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="daily-summary-cards-mobile d-md-none">
          <div
            *ngFor="let day of getPaginatedDailySummary(); trackBy: trackByDate"
            class="daily-summary-card-mobile"
            (click)="showDailyTrades(day.date)">
          <div class="daily-summary-header">
            <div class="daily-summary-left">
              <div class="daily-summary-date">{{ formatDate(day.date) }}</div>
              <div class="daily-summary-count">{{ day.totalTrades }} trade{{ day.totalTrades !== 1 ? 's' : '' }}</div>
            </div>
            <div class="daily-summary-right">
              <div class="daily-summary-net">
                <strong [class]="getProfitLossClass(day.netPnl)">{{ formatCurrency(day.netPnl) }}</strong>
              </div>
              <span class="expand-icon">üëÅÔ∏è</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Daily Summary Pagination -->
      <div *ngIf="getDailyTotalPages() > 1" class="pagination-container mt-3">
        <nav>
          <ul class="pagination justify-content-center mb-0">
            <li class="page-item" [class.disabled]="dailyCurrentPage === 1">
              <a class="page-link" (click)="previousDailyPage()" href="javascript:void(0)">Previous</a>
            </li>
            <li 
              *ngFor="let page of getDailyPageNumbers()" 
              class="page-item" 
              [class.active]="page === dailyCurrentPage">
              <a class="page-link" (click)="goToDailyPage(page)" href="javascript:void(0)">{{ page }}</a>
            </li>
            <li class="page-item" [class.disabled]="dailyCurrentPage === getDailyTotalPages()">
              <a class="page-link" (click)="nextDailyPage()" href="javascript:void(0)">Next</a>
            </li>
          </ul>
        </nav>
        <div class="text-center mt-2 text-muted" style="font-size: 0.85rem;">
          Page {{ dailyCurrentPage }} of {{ getDailyTotalPages() }} ({{ getFilteredDailySummary().length }} day{{ getFilteredDailySummary().length !== 1 ? 's' : '' }})
        </div>
      </div>
    </div>
  </div>

  <!-- Trades List -->
  <div class="trades-list-card mb-4" *ngIf="!isLoading">
    <div class="card-header-modern">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <span class="header-icon-small me-2">üìã</span>
          <h5 class="mb-0">
            Trades ({{ getFilteredTrades().length }})
          </h5>
        </div>
        <button class="collapse-toggle-btn" type="button" (click)="toggleTradesListSection()">
          <span class="collapse-icon" [class.rotated]="!isTradesListExpanded">‚ñº</span>
        </button>
      </div>
    </div>
    <div class="card-body-modern" *ngIf="isTradesListExpanded">
      <div *ngIf="getFilteredTrades().length === 0" class="empty-state">
        <div class="empty-icon">üìä</div>
        <h5>No trades found</h5>
        <p>Start tracking your trades by adding a new trade above.</p>
      </div>
      
      <!-- Desktop Table View -->
      <div *ngIf="getFilteredTrades().length > 0" class="table-responsive d-none d-md-block">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Date</th>
              <th>Index</th>
              <th>Index Value</th>
              <th>Type</th>
              <th>Profit/Loss</th>
              <th>Amount</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let trade of getPaginatedTrades(); trackBy: trackByTradeId" [class.deleting]="deletingTradeIds.has(trade.id)">
              <td class="date-cell"><strong>{{ formatDate(trade.date) }}</strong></td>
              <td>{{ trade.symbol.toUpperCase() }}</td>
              <td>{{ trade.indexValue || 0 | number:'1.0-0' }}</td>
              <td>
                <span class="badge" [class.bg-info]="trade.tradeType === 'call'" [class.bg-warning]="trade.tradeType === 'put'">
                  {{ (trade.tradeType || 'N/A').toUpperCase() }}
                </span>
              </td>
              <td>
                <span class="badge" [class.bg-success]="trade.isProfit" [class.bg-danger]="!trade.isProfit">
                  {{ trade.isProfit ? 'PROFIT' : 'LOSS' }}
                </span>
              </td>
              <td>
                <strong [class]="getProfitLossClass(trade.isProfit ? trade.amount : -trade.amount)">
                  {{ formatCurrency(trade.amount || 0) }}
                </strong>
              </td>
              <td>{{ trade.notes || '-' }}</td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button 
                    class="btn btn-outline-primary"
                    (click)="editTrade(trade)"
                    title="Edit">
                    ‚úèÔ∏è
                  </button>
                  <button 
                    class="btn btn-outline-danger"
                    (click)="deleteTrade(trade)"
                    [disabled]="deletingTradeIds.has(trade.id)"
                    title="Delete">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div *ngIf="getFilteredTrades().length > 0" class="trades-cards-mobile d-md-none">
        <div
          *ngFor="let trade of getPaginatedTrades(); trackBy: trackByTradeId"
          class="trade-card-mobile"
          [class.deleting]="deletingTradeIds.has(trade.id)">
          <div class="trade-card-header-compact">
            <div class="trade-card-left">
              <div class="trade-card-date"><strong>{{ formatDate(trade.date) }}</strong></div>
              <div class="trade-card-index">{{ trade.symbol.toUpperCase() }}</div>
            </div>
            <div class="trade-card-right">
              <div class="trade-card-amount">
                <strong [class]="getProfitLossClass(trade.isProfit ? trade.amount : -trade.amount)">
                  {{ formatCurrency(trade.amount || 0) }}
                </strong>
              </div>
              <div class="trade-card-actions">
                <button 
                  class="btn-icon"
                  (click)="editTrade(trade)"
                  title="Edit">
                  ‚úèÔ∏è
                </button>
                <button 
                  class="btn-icon"
                  (click)="deleteTrade(trade)"
                  [disabled]="deletingTradeIds.has(trade.id)"
                  title="Delete">
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>
          <div class="trade-card-body-compact">
            <div class="trade-card-badges">
              <span class="badge" [class.bg-info]="trade.tradeType === 'call'" [class.bg-warning]="trade.tradeType === 'put'">
                {{ (trade.tradeType || 'N/A').toUpperCase() }}
              </span>
              <span class="badge" [class.bg-success]="trade.isProfit" [class.bg-danger]="!trade.isProfit">
                {{ trade.isProfit ? 'PROFIT' : 'LOSS' }}
              </span>
            </div>
            <div class="trade-card-meta">
              <span class="trade-meta-item">Index Value: {{ trade.indexValue || 0 | number:'1.0-0' }}</span>
              <span class="trade-meta-item" *ngIf="trade.notes">{{ trade.notes }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Trades List Pagination -->
      <div *ngIf="getFilteredTrades().length > itemsPerPage" class="pagination-controls mb-3">
        <div class="pagination-layout">
          <div class="pagination-info">
            <span class="text-muted">
              Showing {{getStartIndex() + 1}} to {{getEndIndex()}} of {{getFilteredTrades().length}} trade{{ getFilteredTrades().length !== 1 ? 's' : '' }}
            </span>
          </div>
          <div class="pagination-navigation">
            <div class="pagination-buttons">
              <button 
                type="button" 
                class="btn btn-outline-secondary btn-sm" 
                [disabled]="currentPage === 1"
                (click)="goToPage(currentPage - 1)"
                title="Previous page">
                ‚Üê Previous
              </button>
              <span class="page-info">
                Page {{currentPage}} of {{getTotalPages()}}
              </span>
              <button 
                type="button" 
                class="btn btn-outline-secondary btn-sm" 
                [disabled]="currentPage === getTotalPages()"
                (click)="goToPage(currentPage + 1)"
                title="Next page">
                Next ‚Üí
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
